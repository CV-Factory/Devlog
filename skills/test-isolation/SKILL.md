---
name: test-isolation
description: 테스트 파일을 tests 디렉토리에 격리하고, 병렬 테스트 워커는 Testcontainers로 환경을 격리하는 원칙과 적용 절차. 로컬 불가 시 docker-compose run --rm 대체 실행 포함.
---

## Rules

- 테스트 파일은 각 프로젝트의 표준 테스트 디렉토리에서 관리
- **비대화형 테스트 실행**: 모든 테스트 명령어는 사용자 입력 대기 없이 즉시 결과를 반환하도록 실행한다. (Watch 모드 사용 금지)
- 로컬 환경 문제(라이브러리 누락, OS 종속성 등)로 인해 테스트 실행이 불가능한 경우, 반드시 도커(Docker) 컨테이너 환경을 활용하여 검증을 수행한다
- 병렬 실행 시에도 테스트 간 상태 공유를 금지하고, 각 병렬 워커의 격리는 표준 환경 격리 도구로 수행
- 각 테스트 파일은 상단에 “이 테스트 묶음이 보호하는 도메인 규칙”을 기록하고, 디렉토리 단위 README.md로 규칙을 요약

## Integration Testing

- 외부 의존성이 있으면 격리된 환경에서 테스트 수행
- 로컬에서 재현이 어렵거나, 환경 의존성이 있으면 컨테이너 실행으로 전환
  - `$env:COMPOSE_MENU='false'; docker compose run --rm <test-service>`

## Completion Criteria

- 테스트가 다른 테스트 실행 순서/병렬 워커에 영향을 받지 않음
- 로컬/컨테이너 실행 중 하나 이상에서 안정적으로 재현 및 통과
- 실패 원인이 환경 노이즈가 아니라 도메인 규칙 위반으로 해석 가능
